{{/* Add our CSS to the head of this page
"load_page_assets" is defined in themes/hugo-flex/layouts/_default/baseof.html */}}

{{ define "load_page_assets" }}
<style>
    .container {
        display: inline-grid;
        grid-template-columns: 30% 70%;
    }

    .item-photo {
        align-self: stretch;
    }

    .item-blurb {
        align-self: center;
    }

    img.person {
        clip-path: circle(50% at 50% 50%);
    }

    figcaption {
        color: black;
        font-weight: bold;
        padding: 2px;
        text-align: center;
    }
</style>
{{ end }}

{{ define "main" }}
<!-- Be sure to set type: publications in frontmatter -->
<!-- https://discourse.gohugo.io/t/single-template-lookup-revisited/16517 -->
<main>
    <article>
        <header>
            <h1>{{.Title}}</h1>
        </header>
        {{ range $stageKey := .Params.stageOrder}} {{/* Loop over all career stages */}}
        {{ $stageName := (index $.Params.stageNames $stageKey) }}
        <h2>{{ $stageName }}</h2> {{/* Create an entry for the stage name */}}
        <div class="container">


            {{/* Loop over all people */}}
            {{ range $person := $.Params.people }}

            {{/* if their career stage matches the current stage, add their entry */}}
            {{ if eq (index $person "stage") $stageKey }}
            <div class="item-photo">
                {{/* If a photo exists, link to it */}}
                {{ with (index $person "src") }}

                {{/* Get the file as a resource */}}
                {{ $image := ($.Resources.GetMatch . )}}
                {{/* Make sure that we actually found something before querying the resource */}}
                {{ with $image }}
                {{ $image := $image.Fit "250x250" }}
                {{ $name := (index $person "name")}}
                <figure>
                    {{/* Link to homepage if exists */}}
                    {{ with (index $person "link") }}<a href={{.}}>{{end}}
                        <img src={{ $image.RelPermalink }} class="person" alt=$name />
                        {{/* Close link to homepage if exists */}}
                        {{ with (index $person "link") }}</a>{{end}}
                    <figcaption>{{ $name }}</figcaption>
                </figure>
                {{ end }}
                {{ end }}
            </div>
            <div class="item-blurb">
                {{/* If a blurb exists, put it here */}}
                {{ with (index $person "blurb") }}
                {{ . | markdownify }}
                {{ end }}
            </div>
            {{ end }}

            {{ end }}
        </div>
        {{ end }}
        <!-- "{{.Content}}" pulls from the markdown content of the corresponding _index.md -->
        {{.Content}}
    </article>
</main>
{{ end }}